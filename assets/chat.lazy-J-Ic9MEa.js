import{c as b,g as m,r as l,s as n,j as s,m as N,B as f,t as w}from"./index-xebXdgSc.js";const E=b("/chat")({component:v});function v(){const i=JSON.parse(m()).user.id,p=JSON.parse(m()).user.user_metadata.username,[d,u]=l.useState(""),[r,c]=l.useState([{content:"Welcome to the chat!",created_at:"",id:"",user_id:"",username:""}]),h=async e=>{if(e.preventDefault(),e.target[0].value===""){w({style:"bg-error text-base-100",message:"Please enter a message"});return}const{error:t}=await n.from("messages").insert({content:e.target[0].value,user_id:i,username:p});u(""),t&&console.error("Error sending message:",t)},g=e=>{e.preventDefault(),u(e.target.value)},j=async()=>{let{data:e}=await n.from("messages").select("*");c(t=>[...t,...e==null?void 0:e.map(a=>a)])},x=l.useRef(null);return l.useEffect(()=>{var e;r.length&&((e=x.current)==null||e.scrollIntoView({behavior:"smooth",block:"end"}))},[r.length]),l.useEffect(()=>{let e=!0;const t=n.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},a=>{c(o=>[...o,a.new])}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},a=>{c(o=>o.filter(y=>y.id!==a.old.id))}).subscribe(async()=>{e&&await j()});return()=>{e=!1,n.removeChannel(t)}},[]),s.jsx(N.main,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"m-0 h-full w-full p-0",children:s.jsxs(f,{styles:"w-full h-full flex flex-col px-10 py-5 gap-10 justify-between",children:[s.jsxs(f,{styles:"w-full max-h-[70vh] flex flex-col flex-grow px-5 py-5 gap-5 overflow-y-scroll no-scrollbar",children:[s.jsx("ul",{className:"flex flex-col justify-start gap-2",children:r.map((e,t)=>s.jsx("li",{className:"flex flex-col text-left",children:t===0?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-center text-xs text-slate-400",children:"System message"}),s.jsx("p",{className:"text-center text-accent",children:e.content})]}):s.jsxs("div",{className:"relative flex flex-col gap-2",children:[s.jsxs("p",{className:"text-xl font-bold capitalize text-primary",children:[e.username,e.user_id===i&&s.jsx("span",{className:"text-xs text-slate-400",children:" (Me)"})]}),s.jsxs("div",{className:"flex justify-between",children:[e.content,s.jsx("span",{className:"flex items-center justify-end text-accent",children:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})]})]})},t))}),s.jsx("div",{ref:x,className:"px-5 text-left"})]}),s.jsxs("form",{onSubmit:h,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:d,onChange:g,placeholder:"Type a message...",className:"input input-bordered flex-grow"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Send"})]})]})})}export{E as Route};
