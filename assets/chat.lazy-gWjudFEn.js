import{c as b,g as m,r as l,s as n,j as s,m as y,B as u,t as N}from"./index-BvEGkZbD.js";const S=b("/chat")({component:v});function v(){const o=JSON.parse(m()).user.id,f=JSON.parse(m()).user.user_metadata.username,[p,i]=l.useState(""),[r,c]=l.useState([{content:"Welcome to the chat!",created_at:"",id:"",user_id:"",username:""}]),d=async e=>{if(e.preventDefault(),e.target[0].value===""){N({style:"bg-error text-base-100",message:"Please enter a message"});return}const{error:t}=await n.from("messages").insert({content:e.target[0].value,user_id:o,username:f});i(""),t&&console.error("Error sending message:",t)},h=e=>{e.preventDefault(),i(e.target.value)},g=async()=>{let{data:e}=await n.from("messages").select("*");c(t=>[...t,...e==null?void 0:e.map(a=>a)])},x=l.useRef(null);return l.useEffect(()=>{var e;r.length&&((e=x.current)==null||e.scrollIntoView({behavior:"smooth",block:"end"}))},[r.length]),l.useEffect(()=>{const e=n.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},t=>{c(a=>[...a,t.new])}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages"},t=>{c(a=>a.filter(j=>j.id!==t.old.id))}).subscribe();return()=>{g(),n.removeChannel(e)}},[]),s.jsx(y.main,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"m-0 h-full w-full p-0",children:s.jsxs(u,{styles:"w-full h-full flex flex-col px-10 py-5 gap-10 justify-between",children:[s.jsxs(u,{styles:"w-full max-h-[70vh] flex flex-col flex-grow px-5 py-5 gap-5 overflow-y-scroll no-scrollbar",children:[s.jsx("ul",{className:"flex flex-col justify-start gap-2",children:r.map((e,t)=>s.jsx("li",{className:"flex flex-col text-left",children:t===0?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-center text-xs text-slate-400",children:"System message"}),s.jsx("p",{className:"text-center text-accent",children:e.content})]}):s.jsxs("div",{className:"relative flex flex-col gap-2",children:[s.jsxs("p",{className:"text-xl font-bold capitalize text-primary",children:[e.username,e.user_id===o&&s.jsx("span",{className:"text-xs text-slate-400",children:" (Me)"})]}),s.jsxs("div",{className:"flex justify-between",children:[e.content,s.jsx("span",{className:"flex items-center justify-end text-accent",children:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})]})]})},t))}),s.jsx("div",{ref:x,className:"px-5 text-left"})]}),s.jsxs("form",{onSubmit:d,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:p,onChange:h,placeholder:"Type a message...",className:"input input-bordered flex-grow"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Send"})]})]})})}export{S as Route};
