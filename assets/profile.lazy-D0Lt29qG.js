import{s as j,j as e,B as S,r as i,g as k,a as B,t as C,c as E,b as F,d as $,u as q,C as z,m as L}from"./index-DtHhp48M.js";import{D as V}from"./DeleteButton-Crq3Jf8Q.js";import{P as A,A as R}from"./Popup-BkxraaMf.js";import{s as U}from"./sendData-DJyqDuZh.js";const G=async t=>{try{const{error:a}=await j.from("characters").delete().eq("id",t);if(a)throw a.message}catch(a){throw a}},J=({deleteID:t,setDeleteID:a,setIsDeleted:c})=>{const s=async l=>{await G(l),c(!0),a("")};return e.jsxs(S,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${t!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>s(t),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>a(""),children:"Cancel"})]})]})},T=async(t,a)=>{try{const{error:c}=await j.from("characters").insert({name:t.name,characterProfile:t,profileID:a});if(c)throw c.message}catch(c){throw c}},Y=({openCreateCharacter:t,setOpenCreateCharacter:a,setIsSave:c})=>{if(!t)return;const[s,l]=i.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),p=async n=>{n.preventDefault();const{user:m}=JSON.parse(k());await T(s,m.id),c(!0),a(!1)};return e.jsx(A,{closerFunc:a,children:e.jsxs(S,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:n=>p(n),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:n=>l({...s,name:n.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:n=>l({...s,level:parseInt(n.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:n=>l({...s,class:n.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:n=>l({...s,subclass:n.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:n=>l({...s,race:n.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:n=>l({...s,subrace:n.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>a(!1),children:"Cancel"})]})]})]})})},H=async({bucket:t,folder:a,name:c})=>{try{if(c=="")return{publicUrl:null};let s=`${a}/${c}`;a==""&&(s=c);const{data:l}=j.storage.from(t).getPublicUrl(s);return l}catch(s){throw s}},o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function K(t,a=0){return(o[t[a+0]]+o[t[a+1]]+o[t[a+2]]+o[t[a+3]]+"-"+o[t[a+4]]+o[t[a+5]]+"-"+o[t[a+6]]+o[t[a+7]]+"-"+o[t[a+8]]+o[t[a+9]]+"-"+o[t[a+10]]+o[t[a+11]]+o[t[a+12]]+o[t[a+13]]+o[t[a+14]]+o[t[a+15]]).toLowerCase()}let N;const M=new Uint8Array(16);function O(){if(!N){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");N=crypto.getRandomValues.bind(crypto)}return N(M)}const W=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),P={randomUUID:W};function _(t,a,c){var l;if(P.randomUUID&&!t)return P.randomUUID();t=t||{};const s=t.random??((l=t.rng)==null?void 0:l.call(t))??O();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,K(s)}const Q=({bucket:t,id:a,folder:c,name:s,characterName:l})=>{const[p,n]=i.useState(""),[m,x]=i.useState(!1),[b,u]=i.useState(!1),[g,y]=i.useState(!1),h=async()=>{const{publicUrl:r}=await H({bucket:t,folder:c,name:s});if(r!==null){if(!r.endsWith(".png")){x(!0),y(!0);return}n(r)}},v=async r=>{var I;r.preventDefault();const f=_(),d=(I=r.target.elements[0].files)==null?void 0:I[0];if(!d)return;if((d==null?void 0:d.size)>1048576){C({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 1MB."});return}const{error:D}=await j.storage.from("characters").upload(`${c}/${f}.png`,d,{cacheControl:"3",upsert:!0});if(D){console.error(D);return}await U("characters",a,{avatar:`${f}.png`}),h(),u(!1),x(!1),C({style:"bg-primary text-base-100",message:"Image changed. It might take some time to update."})},w=async()=>{await U("characters",a,{avatar:null}),h(),u(!1),x(!1),C({style:"bg-primary text-base-100",message:"Image removed. It might take some time to update."})};return i.useEffect(()=>{h(),console.log(p)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>u(!0),children:[g?e.jsx("p",{className:"text-center text-4xl text-primary",children:(l.charAt(0)+l.charAt(1)).toUpperCase()}):e.jsx("img",{src:p,alt:(l.charAt(0)+l.charAt(1)).toUpperCase(),className:`object-cover object-top ${m?"opacity-50 p-2":""}`}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(R,{children:b&&e.jsx(A,{closerFunc:u,children:e.jsxs("form",{onSubmit:v,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:r=>{r.preventDefault(),u(!1)},children:"Cancel"})]}),e.jsx(B,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:w})]})})})]})},se=E("/profile")({component:X});function X(){const{characters:t,setCharacters:a}=F(),{setCharacter:c}=$(),[s,l]=i.useState(!1),[p,n]=i.useState(""),[m,x]=i.useState(!1),[b,u]=i.useState(!1),{user:g}=JSON.parse(k()),y=q(),h=()=>{a(g.id)},v=r=>{c(r),y({to:"/character"})},w=r=>{n(r.id)};return i.useEffect(()=>{h()},[]),i.useEffect(()=>{(s||b)&&(h(),console.log("count")),l(!1),u(!1)},[s,b]),e.jsx(z,{getResetKey:()=>"reset",onCatch:()=>y({to:"/"}),children:e.jsx(L.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(S,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(R,{children:m&&e.jsx(Y,{openCreateCharacter:m,setOpenCreateCharacter:x,setIsSave:u})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:g.user_metadata.username}),e.jsx("button",{onClick:()=>x(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:t.map(r=>{var f,d;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(Q,{bucket:"characters",id:r.id,characterName:r.characterProfile.name,folder:"",name:r.avatar}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>v(r),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[r.characterProfile.name,", ",r.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[r.characterProfile.race," ",(f=r.characterProfile)==null?void 0:f.subrace,","," ",r.characterProfile.class," ",(d=r.characterProfile)==null?void 0:d.subclass]})]})}),e.jsx(V,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>w(r)})]},r.id)})}),p&&e.jsx(J,{deleteID:p,setDeleteID:n,setIsDeleted:l})]})})})}export{se as Route};
