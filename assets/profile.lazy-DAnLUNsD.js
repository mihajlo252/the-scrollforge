import{s as x,r as o,j as e,B as f,g as v,c as N,b as P,u as S,a as k,C as D,m as M}from"./index-DvBhQARo.js";import{P as I}from"./Popup-Bl5e5egr.js";const z=async({bucket:r,folder:t,name:l})=>{try{let s=`${t}/${l}`;t==""&&(s=l);const{data:n}=x.storage.from(r).getPublicUrl(s);return n}catch(s){throw s}},B=({bucket:r,folder:t,name:l,alt:s,fallbackSrc:n})=>{const[u,a]=o.useState(n),[i,h]=o.useState(!1),p=async()=>{const{publicUrl:d}=await z({bucket:r,folder:t,name:l});if(d.endsWith("null")){h(!0);return}a(d)};return o.useEffect(()=>{p()},[]),e.jsx("img",{src:u,alt:s,className:`h-20 w-20 rounded-badge border-2 border-slate-900 ${i?"opacity-50 p-2":""}`})},F=async r=>{try{const{error:t}=await x.from("characters").delete().eq("id",r);if(t)throw t.message}catch(t){throw t}},L=({deleteID:r,setDeleteID:t,setIsDeleted:l})=>{const s=async n=>{await F(n),l(!0),t("")};return e.jsxs(f,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${r!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>s(r),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>t(""),children:"Cancel"})]})]})},E=({size:r,styles:t,event:l})=>e.jsx("button",{className:t,onClick:l,children:e.jsxs("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"493.5,266.5,110,110",children:[e.jsx("g",{id:"document",strokeWidth:"0",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:"10",strokeDasharray:"",strokeDashoffset:"0",fontFamily:"none",fontWeight:"none",fontSize:"none",textAnchor:"none",children:e.jsx("rect",{x:"3140.45455",y:"1211.36364",transform:"scale(0.15714,0.22)",id:"Shape 1 1",vectorEffect:"non-scaling-stroke"})}),e.jsx("g",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",strokeDashoffset:"0",children:e.jsx("g",{id:"stage",children:e.jsxs("g",{id:"layer1 1",children:[e.jsx("path",{d:"M530.85942,356.50159v-51.62872h41.6997v51.52798z",id:"Path 1"}),e.jsx("path",{d:"M552.28263,318.13648v33.5043",id:"Path 1"}),e.jsx("path",{d:"M543.88493,318.13648v33.5043",id:"Path 1"}),e.jsx("path",{d:"M559.53362,318.13648v33.5043",id:"Path 1"}),e.jsx("path",{d:"M530.85942,305.69258c-0.16321,-0.26721 -0.24787,-0.54095 -0.24787,-0.81971c0,-2.94415 9.44578,-5.33086 21.09772,-5.33086c11.65195,0 21.09772,2.38671 21.09772,5.33086c0,0.27874 -0.08467,0.5525 -0.24787,0.81971c-1.56054,2.555 -10.30109,4.51115 -20.84985,4.51115c-10.54876,0 -19.28931,-1.95616 -20.84985,-4.51115z",id:"Path 1"}),e.jsx("path",{d:"M526.99843,299.96332l-0.62718,2.33336c-0.20632,-0.66738 0.08483,-1.417 0.62718,-2.33336z",id:"Path 1"}),e.jsx("path",{d:"M526.90801,299.89208c1.69662,-2.86672 6.73622,-6.66812 13.1139,-9.62877c6.7301,-3.12425 12.92278,-4.3711 15.64124,-3.36979l1.92001,0.76878l2.09371,1.26963l1.3539,0.82101c1.3487,0.10911 2.21953,0.51753 2.47137,1.25174c0.0889,0.25918 0.09747,0.54969 0.03094,0.86743c-0.63617,3.03834 -8.1395,8.56871 -17.94801,13.04798c-9.8085,4.47929 -18.55957,6.37187 -20.82544,4.65881c-0.23697,-0.17916 -0.403,-0.39773 -0.49191,-0.65692c-0.25631,-0.74726 0.15506,-1.75476 1.10906,-2.92539l0.37047,-1.37834z",id:"Path 1"}),e.jsx("path",{d:"",id:"Path 1",fill:"transparent"}),e.jsx("path",{d:"M534.05344,289.75448l3.4456,-2.48803l4.18002,-0.76803l0.73442,1.72l-3.4456,2.48803l-4.18002,0.76803z",id:"Path 1"})]})})})]})}),q="/dash-and-play/assets/avatarplaceholder.png",R=async(r,t)=>{try{const{error:l}=await x.from("characters").insert({name:r.name,characterProfile:r,profileID:t});if(l)throw l.message}catch(l){throw l}},W=({openCreateCharacter:r,setOpenCreateCharacter:t,setIsSave:l})=>{if(!r)return;const[s,n]=o.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),u=async a=>{a.preventDefault();const{user:i}=JSON.parse(v());await R(s,i.id),l(!0),t(!1)};return e.jsx(I,{closerFunc:t,children:e.jsxs(f,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:a=>u(a),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:a=>n({...s,name:a.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:a=>n({...s,level:parseInt(a.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:a=>n({...s,class:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:a=>n({...s,subclass:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:a=>n({...s,race:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:a=>n({...s,subrace:a.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},G=N("/profile")({component:$});function $(){const{characters:r,setCharacters:t}=P(),{setCharacter:l}=S(),[s,n]=o.useState(!1),[u,a]=o.useState(""),[i,h]=o.useState(!1),[p,d]=o.useState(!1),{user:m}=JSON.parse(v()),b=k(),g=()=>{t(m.id)},C=c=>{l(c),b({to:"/character"})},w=c=>{a(c.id)};return o.useEffect(()=>{g()},[]),o.useEffect(()=>{(s||p)&&(g(),console.log("count")),n(!1),d(!1)},[s,p]),e.jsx(D,{getResetKey:()=>"reset",onCatch:()=>b({to:"/"}),children:e.jsx(M.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(f,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[i&&e.jsx(W,{openCreateCharacter:i,setOpenCreateCharacter:h,setIsSave:d}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:m.user_metadata.username}),e.jsx("button",{onClick:()=>h(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:r.map(c=>{var j,y;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsxs("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>C(c),children:[e.jsx(B,{bucket:"characters",folder:"",name:c.avatar,alt:c.characterProfile.name,fallbackSrc:q}),e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[c.characterProfile.name,", ",c.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[c.characterProfile.race," ",(j=c.characterProfile)==null?void 0:j.subrace,","," ",c.characterProfile.class," ",(y=c.characterProfile)==null?void 0:y.subclass]})]})]}),e.jsx(E,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>w(c)})]},c.id)})}),e.jsx(L,{deleteID:u,setDeleteID:a,setIsDeleted:n})]})})})}export{G as Route};
