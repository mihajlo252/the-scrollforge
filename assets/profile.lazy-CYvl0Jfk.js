import{s as j,r as i,j as e,t as D,B as C,g as w,c as k,a as I,b as F,u as E,C as $,m as B}from"./index-Bh7AkYPZ.js";import{A as S,P}from"./Popup-81MhEjIh.js";import{s as q}from"./sendData-Dta-DOhI.js";import{D as R}from"./DeleteButton-Dic7vKxo.js";const U=async({bucket:c,folder:a,name:l})=>{try{if(l=="")return{publicUrl:null};let s=`${a}/${l}`;a==""&&(s=l);const{data:n}=j.storage.from(c).getPublicUrl(s);return n}catch(s){throw s}},A=({bucket:c,id:a,folder:l,name:s,characterName:n,alt:p,fallbackSrc:t})=>{const[d,h]=i.useState(t),[f,m]=i.useState(!1),[x,u]=i.useState(!1),[b,v]=i.useState(),g=async()=>{const{publicUrl:o}=await U({bucket:c,folder:l,name:s});if(o==null){m(!0);return}h(o)},r=async o=>{o.preventDefault();const{error:N}=await j.storage.from("characters").upload(`${l}/${n}.png`,b,{cacheControl:"3",upsert:!0});if(N){console.error(N);return}await q("characters",a,{avatar:`${n}.png`}),g(),u(!1),m(!1),D({style:"bg-primary border-primary text-base-100",message:"Image changed, please refresh the page"})},y=()=>{h(t),u(!1),m(!0)};return i.useEffect(()=>{g(),console.log(d)},[]),e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"relative",onClick:()=>u(!0),children:e.jsx("img",{src:d,onError:y,alt:p,className:`object-contain max-h-24 w-24 rounded-badge border-2 border-slate-900 ${f?"opacity-50 p-2":""}`})}),e.jsx(S,{children:x&&e.jsx(P,{closerFunc:u,children:e.jsxs("form",{onSubmit:o=>r(o),className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",onChange:o=>v(o.target.files[0]),className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:o=>{o.preventDefault(),u(!1)},children:"Cancel"})]}),e.jsxs("p",{className:"text-[18px]",children:["Please name your image ",e.jsx("span",{className:"text-secondary",children:"*name-of-character*.png"})]})]})})})]})},L=async c=>{try{const{error:a}=await j.from("characters").delete().eq("id",c);if(a)throw a.message}catch(a){throw a}},z=({deleteID:c,setDeleteID:a,setIsDeleted:l})=>{const s=async n=>{await L(n),l(!0),a("")};return e.jsxs(C,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${c!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>s(c),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>a(""),children:"Cancel"})]})]})},G="/dash-and-play/assets/avatarplaceholder.png",J=async(c,a)=>{try{const{error:l}=await j.from("characters").insert({name:c.name,characterProfile:c,profileID:a});if(l)throw l.message}catch(l){throw l}},Y=({openCreateCharacter:c,setOpenCreateCharacter:a,setIsSave:l})=>{if(!c)return;const[s,n]=i.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),p=async t=>{t.preventDefault();const{user:d}=JSON.parse(w());await J(s,d.id),l(!0),a(!1)};return e.jsx(P,{closerFunc:a,children:e.jsxs(C,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:t=>p(t),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:t=>n({...s,name:t.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:t=>n({...s,level:parseInt(t.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:t=>n({...s,class:t.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:t=>n({...s,subclass:t.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:t=>n({...s,race:t.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:t=>n({...s,subrace:t.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>a(!1),children:"Cancel"})]})]})]})})},H=k("/profile")({component:K});function K(){const{characters:c,setCharacters:a}=I(),{setCharacter:l}=F(),[s,n]=i.useState(!1),[p,t]=i.useState(""),[d,h]=i.useState(!1),[f,m]=i.useState(!1),{user:x}=JSON.parse(w()),u=E(),b=()=>{a(x.id)},v=r=>{l(r),u({to:"/character"})},g=r=>{t(r.id)};return i.useEffect(()=>{b()},[]),i.useEffect(()=>{(s||f)&&(b(),console.log("count")),n(!1),m(!1)},[s,f]),e.jsx($,{getResetKey:()=>"reset",onCatch:()=>u({to:"/"}),children:e.jsx(B.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(C,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(S,{children:d&&e.jsx(Y,{openCreateCharacter:d,setOpenCreateCharacter:h,setIsSave:m})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:x.user_metadata.username}),e.jsx("button",{onClick:()=>h(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:c.map(r=>{var y,o;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(A,{bucket:"characters",id:r.id,characterName:r.characterProfile.name,folder:"",name:r.avatar,alt:r.characterProfile.name,fallbackSrc:G}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>v(r),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[r.characterProfile.name,", ",r.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[r.characterProfile.race," ",(y=r.characterProfile)==null?void 0:y.subrace,","," ",r.characterProfile.class," ",(o=r.characterProfile)==null?void 0:o.subclass]})]})}),e.jsx(R,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>g(r)})]},r.id)})}),p&&e.jsx(z,{deleteID:p,setDeleteID:t,setIsDeleted:n})]})})})}export{H as Route};
