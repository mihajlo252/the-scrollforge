import{s as y,j as e,A as E,P as v,B as w,r as l,g as L,a as B,t as j,c as R,b as T,d as G,u as O,C as z,m as k}from"./index-DUak8AQi.js";import{D as J}from"./DeleteButton-FjQQMUOu.js";const U=async t=>{try{const{error:a}=await y.from("characters").delete().eq("id",t);if(a)throw a.message}catch(a){throw a}},M=({deleteID:t,setDeleteID:a,setIsDeleted:s,setIsDelete:r,toggle:u})=>{const o=async c=>{await U(c),s(!0),r(!1),a("")},d=c=>{c.preventDefault(),r(!1),a("")};return e.jsx(E,{children:u&&e.jsx(v,{closerFunc:r,toggle:u,children:e.jsxs(w,{styles:"fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5",children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(t),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:d,children:"Cancel"})]})]})})})},I=async(t,a,s)=>{try{const{error:r}=await y.from("characters").insert({name:t.name,characterProfile:t,profileID:a,gamemode:s});if(r)throw r.message}catch(r){throw r}},_=({setCharacterProfile:t,characterProfile:a})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:s=>t({...a,name:s.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:s=>t({...a,level:parseInt(s.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:s=>t({...a,class:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:s=>t({...a,subclass:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:s=>t({...a,race:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:s=>t({...a,subrace:s.target.value})})]}),H=({setCharacterProfileDaggerheart:t,characterProfileDaggerheart:a})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:s=>t({...a,name:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:s=>t({...a,class:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Domains",required:!0,onChange:s=>t({...a,domains:s.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",onChange:s=>t({...a,level:parseInt(s.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Pronouns",required:!0,onChange:s=>t({...a,pronouns:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Heritage",onChange:s=>t({...a,heritage:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:s=>t({...a,subclass:s.target.value})})]}),K=({openCreateCharacter:t,setOpenCreateCharacter:a,setIsSave:s,gameMode:r})=>{if(!t)return;const[u,o]=l.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),[d,c]=l.useState({name:"",class:"",domains:"",level:0,pronouns:"",heritage:"",subclass:""}),f=async m=>{m.preventDefault();const{user:g}=JSON.parse(L());r==="D&D"&&await I(u,g.id,r),r==="Daggerheart"&&await I(d,g.id,r),s(!0),a(!1)};return e.jsxs(w,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:m=>f(m),children:[r==="D&D"&&e.jsx(_,{setCharacterProfile:o,characterProfile:u}),r==="Daggerheart"&&e.jsx(H,{setCharacterProfileDaggerheart:c,characterProfileDaggerheart:d}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>a(!1),children:"Cancel"})]})]})]})},P=({bucket:t,characterName:a})=>{const[s,r]=l.useState(`https://iyfoqgbhaxcedpmuvfkr.supabase.co/storage/v1/object/public/${t}/${a}.png`),[u,o]=l.useState(!1),[d,c]=l.useState(!0),f=async()=>{fetch(s,{method:"HEAD"}).then(async p=>{p.ok&&c(!1)})},m=async p=>{var b;p.preventDefault();const h=(b=p.target.elements[0].files)==null?void 0:b[0];if(!h)return;if((h==null?void 0:h.size)>307200){j({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 300KB."});return}const{error:i}=await y.storage.from("characters").upload(`${a}.png`,h,{cacheControl:"0",upsert:!0});i||(o(!1),c(!1),r(x=>`${x}?t=${Date.now()}`),j({style:"bg-primary text-base-100",message:"Image changed!"}))},g=async()=>{await y.storage.from("characters").remove([`${a}.png`]),r(p=>`${p}?t=${Date.now()}`),o(!1),c(!0),j({style:"bg-primary text-base-100",message:"Image removed!"})};return l.useEffect(()=>{f()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>o(!0),children:[e.jsx("img",{src:s,onError:()=>c(!0),alt:(a.charAt(0)+a.charAt(1)).toUpperCase(),className:`object-cover object-top text-center text-4xl text-primary transition-opacity ${d&&"opacity-0"}`}),e.jsx("div",{className:`absolute inset-0 place-content-center text-center text-4xl text-primary transition-opacity opacity-0 ${d&&"opacity-100"}`,children:e.jsx("p",{children:(a.charAt(0)+a.charAt(1)).toUpperCase()})}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(v,{closerFunc:o,toggle:u,children:e.jsxs("form",{onSubmit:m,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:p=>{p.preventDefault(),o(!1)},children:"Cancel"})]}),e.jsx(B,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:g})]})})]})},Y=({character:t,handleNavigateToCharacter:a})=>{var s,r;return e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>a(t),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[t.characterProfile.name,", ",t.characterProfile.level]}),e.jsxs("p",{children:[t.characterProfile.race," ",(s=t.characterProfile)==null?void 0:s.subrace,", ",t.characterProfile.class," ",(r=t.characterProfile)==null?void 0:r.subclass]})]})})},Q=({character:t,handleNavigateToCharacter:a})=>{var s,r;return e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>a(t),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[t.characterProfile.name,", ",t.characterProfile.level]}),e.jsxs("p",{children:[t.characterProfile.heritage,", ",(s=t.characterProfile)==null?void 0:s.domains,", ",t.characterProfile.class," ",(r=t.characterProfile)==null?void 0:r.subclass]})]})})},Z=R("/profile")({component:V});function V(){const{characters:t,setCharacters:a}=T(),{setCharacter:s}=G(),[r,u]=l.useState(!1),[o,d]=l.useState(""),[c,f]=l.useState(!1),[m,g]=l.useState(!1),[p,h]=l.useState(!1),[i,b]=l.useState(JSON.parse(JSON.stringify(localStorage.getItem("gameMode")))??"D&D"),x=l.useRef(null),{user:N}=JSON.parse(L()),D=O(),C=()=>{a(N.id)},S=n=>{s(n),D({to:`/${i==="D&D"?"dnd":"daggerheart"}/character/`})},F=n=>{d(n.id),h(!0)},q=n=>{i==="D&D"?(b("Daggerheart"),localStorage.setItem("gameMode","Daggerheart"),n.target.innerText="Dungeons&Dragons",n.target.classList.remove("btn-accent"),n.target.classList.add("btn-primary")):(b("D&D"),localStorage.setItem("gameMode","D&D"),n.target.innerText="Daggerheart",n.target.classList.remove("btn-primary"),n.target.classList.add("btn-accent"))},A=()=>{x.current&&(i==="Daggerheart"?(x.current.innerText="Dungeons&Dragons",x.current.classList.remove("btn-accent"),x.current.classList.add("btn-primary")):(x.current.innerText="Daggerheart",x.current.classList.remove("btn-primary"),x.current.classList.add("btn-accent")))};return l.useEffect(()=>{C(),A()},[]),l.useEffect(()=>{(r||m)&&C(),u(!1),g(!1)},[r,m]),e.jsx(z,{getResetKey:()=>"reset",onCatch:()=>D({to:"/"}),children:e.jsx(k.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(w,{styles:"w-full flex flex-col items-start gap-5 p-5 overflow-y-scroll relative",children:[e.jsx(v,{toggle:c,closerFunc:f,children:e.jsx(K,{openCreateCharacter:c,setOpenCreateCharacter:f,setIsSave:g,gameMode:i})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:N.user_metadata.username}),e.jsx("button",{ref:x,className:"btn btn-accent",onClick:q,children:"Daggerheart"})]}),e.jsxs("section",{className:" h-full w-full overflow-y-scroll",children:[e.jsxs("ul",{className:"flex w-full h-1 flex-col gap-2 text-xl",children:[t.filter(n=>n.gamemode===i).length===0&&e.jsx("p",{className:"text-xl text-accent text-left w-max",children:"Nothing forged yet!"}),t.filter(n=>n.gamemode===i).sort((n,$)=>new Date(n.created_at).getTime()-new Date($.created_at).getTime()).map(n=>e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.35,ease:"easeOut",delay:0},className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(P,{bucket:"characters",characterName:n.characterProfile.name.toLowerCase()}),i==="D&D"&&e.jsx(Y,{character:n,handleNavigateToCharacter:S}),i==="Daggerheart"&&e.jsx(Q,{character:n,handleNavigateToCharacter:S}),e.jsx(J,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>F(n)})]},n.id))]}),e.jsx(M,{toggle:p,deleteID:o,setDeleteID:d,setIsDeleted:u,setIsDelete:h})]}),e.jsx("button",{onClick:()=>f(!0),className:"btn btn-ghost btn-circle place-self-center border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100 hover:scale-[1.1]",children:"+"})]})})})}export{Z as Route};
