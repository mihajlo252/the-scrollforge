import{c as g,r as a,s as n,j as s,m as h,B as u,t as d,g as b}from"./index-fjAxryxt.js";const w=g("/chat")({component:y});function y(){const[m,o]=a.useState(""),[r,c]=a.useState([{}]),f=async e=>{if(e.preventDefault(),e.target[0].value===""){d({style:"bg-error text-base-100",message:"Please enter a message"});return}const t=JSON.parse(b()).user.id,{error:l}=await n.from("messages").insert({content:e.target[0].value,user_id:t,username:"beca"});o(""),l&&console.error("Error sending message:",l)},x=e=>{e.preventDefault(),o(e.target.value)},p=async()=>{let{data:e}=await n.from("messages").select("*");e&&c(e.map(t=>t))};a.useEffect(()=>{p();const e=n.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},t=>{c(l=>[...l,t.new])}).subscribe();return()=>{n.removeChannel(e)}},[]);const i=a.useRef(null);return a.useEffect(()=>{var e;r.length&&((e=i.current)==null||e.scrollIntoView({behavior:"smooth",block:"end"}))},[r.length]),s.jsx(h.main,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"m-0 h-full w-full p-0",children:s.jsxs(u,{styles:"w-full h-full flex flex-col px-10 py-5 gap-10 justify-between",children:[s.jsxs(u,{styles:"w-full max-h-[70vh] flex flex-col flex-grow px-5 py-5 gap-5 overflow-y-scroll no-scrollbar",children:[s.jsx("ul",{className:"flex flex-col justify-start gap-2",children:r.map((e,t)=>s.jsxs("li",{className:"flex flex-col text-left",children:[s.jsx("label",{className:"text-xl font-bold capitalize text-primary",children:e.username}),s.jsxs("div",{className:"flex justify-between",children:[e.content,s.jsx("span",{className:"text-accent",children:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})]})]},t))}),s.jsx("div",{ref:i,className:"px-5 text-left"})]}),s.jsxs("form",{onSubmit:f,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:m,onChange:x,placeholder:"Type a message...",className:"input input-bordered flex-grow"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Send"})]})]})})}export{w as Route};
