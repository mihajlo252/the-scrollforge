import{s as x,j as e,B as v,r as i,g as N,a as P,t as j,c as I,b as k,d as $,u as A,C as E,m as F}from"./index-BmVCYnAX.js";import{D as B}from"./DeleteButton-V4jo0B4o.js";import{P as S,A as D}from"./Popup-DC3y3mTv.js";const R=async l=>{try{const{error:t}=await x.from("characters").delete().eq("id",l);if(t)throw t.message}catch(t){throw t}},U=({deleteID:l,setDeleteID:t,setIsDeleted:s})=>{const r=async c=>{await R(c),s(!0),t("")};return e.jsxs(v,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${l!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>r(l),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>t(""),children:"Cancel"})]})]})},q=async(l,t)=>{try{const{error:s}=await x.from("characters").insert({name:l.name,characterProfile:l,profileID:t});if(s)throw s.message}catch(s){throw s}},z=({openCreateCharacter:l,setOpenCreateCharacter:t,setIsSave:s})=>{if(!l)return;const[r,c]=i.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),u=async a=>{a.preventDefault();const{user:p}=JSON.parse(N());await q(r,p.id),s(!0),t(!1)};return e.jsx(S,{closerFunc:t,children:e.jsxs(v,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:a=>u(a),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:a=>c({...r,name:a.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:a=>c({...r,level:parseInt(a.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:a=>c({...r,class:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:a=>c({...r,subclass:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:a=>c({...r,race:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:a=>c({...r,subrace:a.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},L=async({bucket:l,name:t})=>{try{if(t=="")return{publicUrl:null};const{data:s}=x.storage.from(l).getPublicUrl(t);return s}catch(s){throw s}},G=({bucket:l,characterName:t})=>{const[s,r]=i.useState(""),[c,u]=i.useState(!1),[a,p]=i.useState(!1),m=async()=>{const{publicUrl:o}=await L({bucket:l,name:`${t}.png`});o!==null&&r(`${o}?t=${Date.now()}`)},h=async o=>{var g;o.preventDefault();const d=(g=o.target.elements[0].files)==null?void 0:g[0];if(!d)return;if((d==null?void 0:d.size)>1048576){j({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 1MB."});return}const{error:b}=await x.storage.from("characters").upload(`${t}.png`,d,{cacheControl:"0",upsert:!0});b||(u(!1),p(!1),r(y=>`${y}?t=${Date.now()}`),j({style:"bg-primary text-base-100",message:"Image changed. It might take some time to update."}))},f=async()=>{await x.storage.from("characters").remove([`${t}.png`]),r(o=>`${o}?t=${Date.now()}`),u(!1),p(!0),j({style:"bg-primary text-base-100",message:"Image removed. It might take some time to update."})};return i.useEffect(()=>{m()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>u(!0),children:[e.jsx("img",{src:s,onError:()=>p(!0),alt:(t.charAt(0)+t.charAt(1)).toUpperCase(),className:`object-cover object-top text-center text-4xl text-primary ${a&&"opacity-0"}`}),e.jsx("div",{className:`absolute inset-0 place-content-center text-center text-4xl text-primary opacity-0 ${a&&"opacity-100"}`,children:e.jsx("p",{children:(t.charAt(0)+t.charAt(1)).toUpperCase()})}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(D,{children:c&&e.jsx(S,{closerFunc:u,children:e.jsxs("form",{onSubmit:h,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:o=>{o.preventDefault(),u(!1)},children:"Cancel"})]}),e.jsx(P,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:f})]})})})]})},O=I("/profile")({component:J});function J(){const{characters:l,setCharacters:t}=k(),{setCharacter:s}=$(),[r,c]=i.useState(!1),[u,a]=i.useState(""),[p,m]=i.useState(!1),[h,f]=i.useState(!1),{user:o}=JSON.parse(N()),d=A(),b=()=>{t(o.id)},g=n=>{s(n),d({to:"/character"})},y=n=>{a(n.id)};return i.useEffect(()=>{b()},[]),i.useEffect(()=>{(r||h)&&(b(),console.log("count")),c(!1),f(!1)},[r,h]),e.jsx(E,{getResetKey:()=>"reset",onCatch:()=>d({to:"/"}),children:e.jsx(F.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(v,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(D,{children:p&&e.jsx(z,{openCreateCharacter:p,setOpenCreateCharacter:m,setIsSave:f})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:o.user_metadata.username}),e.jsx("button",{onClick:()=>m(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:l.map(n=>{var C,w;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(G,{bucket:"characters",characterName:n.characterProfile.name.toLowerCase()}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>g(n),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[n.characterProfile.name,", ",n.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[n.characterProfile.race," ",(C=n.characterProfile)==null?void 0:C.subrace,","," ",n.characterProfile.class," ",(w=n.characterProfile)==null?void 0:w.subclass]})]})}),e.jsx(B,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>y(n)})]},n.id)})}),u&&e.jsx(U,{deleteID:u,setDeleteID:a,setIsDeleted:c})]})})})}export{O as Route};
