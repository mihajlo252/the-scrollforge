import{s as y,j as e,P as w,B as N,r as n,g as F,A as v,a as E,t as j,c as L,b as B,d as R,u as T,C as z,m as k}from"./index-nOD3aBZd.js";import{D as G}from"./DeleteButton-J6UCaKKt.js";const J=async t=>{try{const{error:a}=await y.from("characters").delete().eq("id",t);if(a)throw a.message}catch(a){throw a}},O=({deleteID:t,setDeleteID:a,setIsDeleted:s,setIsDelete:r})=>{const d=async o=>{await J(o),s(!0),r(!1),a("")},c=o=>{o.preventDefault(),r(!1),a("")};return e.jsx(w,{closerFunc:r,children:e.jsxs(N,{styles:"fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5",children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>d(t),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:c,children:"Cancel"})]})]})})},I=async(t,a,s)=>{try{const{error:r}=await y.from("characters").insert({name:t.name,characterProfile:t,profileID:a,gamemode:s});if(r)throw r.message}catch(r){throw r}},U=({setCharacterProfile:t,characterProfile:a})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:s=>t({...a,name:s.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:s=>t({...a,level:parseInt(s.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:s=>t({...a,class:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:s=>t({...a,subclass:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:s=>t({...a,race:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:s=>t({...a,subrace:s.target.value})})]}),_=({setCharacterProfileDaggerheart:t,characterProfileDaggerheart:a})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:s=>t({...a,name:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:s=>t({...a,class:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Domains",required:!0,onChange:s=>t({...a,domains:s.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",onChange:s=>t({...a,level:parseInt(s.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Pronouns",required:!0,onChange:s=>t({...a,pronouns:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Heritage",onChange:s=>t({...a,heritage:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:s=>t({...a,subclass:s.target.value})})]}),H=({openCreateCharacter:t,setOpenCreateCharacter:a,setIsSave:s,gameMode:r})=>{if(!t)return;const[d,c]=n.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),[o,p]=n.useState({name:"",class:"",domains:"",level:0,pronouns:"",heritage:"",subclass:""}),f=async x=>{x.preventDefault();const{user:h}=JSON.parse(F());r==="D&D"&&await I(d,h.id,r),r==="Daggerheart"&&await I(o,h.id,r),s(!0),a(!1)};return e.jsx(w,{closerFunc:a,children:e.jsxs(N,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:x=>f(x),children:[r==="D&D"&&e.jsx(U,{setCharacterProfile:c,characterProfile:d}),r==="Daggerheart"&&e.jsx(_,{setCharacterProfileDaggerheart:p,characterProfileDaggerheart:o}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>a(!1),children:"Cancel"})]})]})]})})},K=({bucket:t,characterName:a})=>{const[s,r]=n.useState(`https://iyfoqgbhaxcedpmuvfkr.supabase.co/storage/v1/object/public/${t}/${a}.png`),[d,c]=n.useState(!1),[o,p]=n.useState(!0),f=async()=>{fetch(s,{method:"HEAD"}).then(async i=>{i.ok&&p(!1)})},x=async i=>{var g;i.preventDefault();const m=(g=i.target.elements[0].files)==null?void 0:g[0];if(!m)return;if((m==null?void 0:m.size)>307200){j({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 300KB."});return}const{error:u}=await y.storage.from("characters").upload(`${a}.png`,m,{cacheControl:"0",upsert:!0});u||(c(!1),p(!1),r(b=>`${b}?t=${Date.now()}`),j({style:"bg-primary text-base-100",message:"Image changed!"}))},h=async()=>{await y.storage.from("characters").remove([`${a}.png`]),r(i=>`${i}?t=${Date.now()}`),c(!1),p(!0),j({style:"bg-primary text-base-100",message:"Image removed!"})};return n.useEffect(()=>{f()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>c(!0),children:[e.jsx("img",{src:s,onError:()=>p(!0),alt:(a.charAt(0)+a.charAt(1)).toUpperCase(),className:`object-cover object-top text-center text-4xl text-primary transition-opacity ${o&&"opacity-0"}`}),e.jsx("div",{className:`absolute inset-0 place-content-center text-center text-4xl text-primary transition-opacity opacity-0 ${o&&"opacity-100"}`,children:e.jsx("p",{children:(a.charAt(0)+a.charAt(1)).toUpperCase()})}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(v,{children:d&&e.jsx(w,{closerFunc:c,children:e.jsxs("form",{onSubmit:x,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:i=>{i.preventDefault(),c(!1)},children:"Cancel"})]}),e.jsx(E,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:h})]})})})]})},P=({character:t,handleNavigateToCharacter:a})=>{var s,r;return e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>a(t),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[t.characterProfile.name,", ",t.characterProfile.level]}),e.jsxs("p",{children:[t.characterProfile.race," ",(s=t.characterProfile)==null?void 0:s.subrace,", ",t.characterProfile.class," ",(r=t.characterProfile)==null?void 0:r.subclass]})]})})},Y=({character:t,handleNavigateToCharacter:a})=>{var s,r;return e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>a(t),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[t.characterProfile.name,", ",t.characterProfile.level]}),e.jsxs("p",{children:[t.characterProfile.heritage,", ",(s=t.characterProfile)==null?void 0:s.domains,", ",t.characterProfile.class," ",(r=t.characterProfile)==null?void 0:r.subclass]})]})})},W=L("/profile")({component:M});function M(){const{characters:t,setCharacters:a}=B(),{setCharacter:s}=R(),[r,d]=n.useState(!1),[c,o]=n.useState(""),[p,f]=n.useState(!1),[x,h]=n.useState(!1),[i,m]=n.useState(!1),[u,g]=n.useState(JSON.parse(JSON.stringify(localStorage.getItem("gameMode")))||"D&D"),{user:b}=JSON.parse(F()),C=T(),D=()=>{a(b.id)},S=l=>{s(l),C({to:`/character/${u==="D&D"?"dnd":"daggerheart"}`})},q=l=>{o(l.id),m(!0)},A=l=>{u==="D&D"?(g("Daggerheart"),localStorage.setItem("gameMode","Daggerheart"),l.target.innerText="Dungeons&Dragons",l.target.classList.remove("btn-accent"),l.target.classList.add("btn-primary")):(g("D&D"),localStorage.setItem("gameMode","D&D"),l.target.innerText="Daggerheart",l.target.classList.remove("btn-primary"),l.target.classList.add("btn-accent"))};return n.useEffect(()=>{D()},[]),n.useEffect(()=>{(r||x)&&D(),d(!1),h(!1)},[r,x]),e.jsx(z,{getResetKey:()=>"reset",onCatch:()=>C({to:"/"}),children:e.jsx(k.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(N,{styles:"w-full flex flex-col items-start gap-5 p-5 overflow-y-scroll relative",children:[e.jsx(v,{children:p&&e.jsx(H,{openCreateCharacter:p,setOpenCreateCharacter:f,setIsSave:h,gameMode:u})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:b.user_metadata.username}),e.jsx("button",{className:"btn btn-accent",onClick:A,children:"Daggerheart"})]}),e.jsxs("section",{className:" h-full w-full overflow-y-scroll",children:[e.jsxs("ul",{className:"flex w-full h-1 flex-col gap-2 text-xl",children:[t.filter(l=>l.gamemode===u).length===0&&e.jsx("p",{className:"text-xl text-accent text-left w-max",children:"Nothing forged yet!"}),t.filter(l=>l.gamemode===u).sort((l,$)=>new Date(l.created_at).getTime()-new Date($.created_at).getTime()).map(l=>e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.35,ease:"easeOut",delay:0},className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(K,{bucket:"characters",characterName:l.characterProfile.name.toLowerCase()}),u==="D&D"&&e.jsx(P,{character:l,handleNavigateToCharacter:S}),u==="Daggerheart"&&e.jsx(Y,{character:l,handleNavigateToCharacter:S}),e.jsx(G,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>q(l)})]},l.id))]}),e.jsx(v,{children:i&&e.jsx(O,{deleteID:c,setDeleteID:o,setIsDeleted:d,setIsDelete:m})})]}),e.jsx("button",{onClick:()=>f(!0),className:"btn btn-ghost btn-circle place-self-center border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100 hover:scale-[1.1]",children:"+"})]})})})}export{W as Route};
