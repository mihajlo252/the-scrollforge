import{s as d,r as c,j as e,B as b,t as n,c as y,g as j,m as v,P as N}from"./index-yhRaaFJe.js";const S=async r=>{try{const{error:s}=await d.from("tickets").insert(r);if(s)throw s.message}catch(s){throw s}},k=()=>{const[r,s]=c.useState([]),o=async()=>{const{data:t,error:l}=await d.from("tickets").select("*").limit(20).order("created_at",{ascending:!1});l&&n({style:"bg-error text-base-100",message:"Error getting tickets:"+l}),s(t)};return c.useEffect(()=>{o()},[]),e.jsxs(b,{styles:"w-[65%] h-full flex flex-col px-10 py-5",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Ticket Log"}),e.jsx("div",{className:"flex flex-col gap-5 mt-10 overflow-y-scroll overflow-x-visible",children:r.map(t=>e.jsxs("div",{className:"flex flex-col text-left gap-2",children:[e.jsxs("h2",{className:"text-sm text-gray-500",children:[t.type," | ",new Date(t.created_at).toLocaleDateString()," |"," ",e.jsx("span",{className:t.status==="Open"?"text-accent":t.status==="Complete"?"text-success":"text-primary",children:t.status})]}),e.jsxs("div",{className:"border-slate-900 rounded-[1em] corner-squircle py-2 px-2 border-2",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"text-accent",children:"App section:"})," ",t.appSection]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-accent",children:"Description:"})," ",t.description]})]})]},t.id))})]})},L=y("/tickets")({component:w});function w(){const[r,s]=c.useState(""),[o,t]=c.useState(""),[l,m]=c.useState("Bug Report"),[f,u]=c.useState(!1),{user:g}=JSON.parse(j()),h=async a=>{a.preventDefault();const i={appSection:r,description:o,user_id:g.id,type:l};if(i.appSection===""||i.description===""){n({style:"bg-error text-base-100",message:"Please fill out all fields"});return}let x;try{await S(i),n({style:"bg-success text-base-100",message:"Ticket sent!"})}catch(p){throw x=p,n({style:"bg-success text-base-100",message:"Ticket not sent! There was an error: "+p}),p}x||(s(""),t(""))};return e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"h-full",children:[e.jsxs("form",{className:"flex h-full w-full flex-col items-center justify-center gap-10 rounded-lg border-2 border-slate-900 bg-base-300 px-[25%] text-left text-neutral",onSubmit:a=>h(a),children:[e.jsx("h1",{className:"sticky top-0 w-full text-center text-3xl font-bold text-primary",children:"Select feature if you have a feature request or bug report if you've found one."}),e.jsx("div",{className:"flex w-full flex-col gap-2",children:e.jsxs("select",{className:"select select-bordered",value:l,onChange:a=>m(a.target.value),children:[e.jsx("option",{value:"Bug Report",children:"Bug Report"}),e.jsx("option",{value:"Feature",children:"Feature"})]})}),e.jsxs("div",{className:"flex w-full flex-col gap-5",children:[e.jsx("input",{type:"text",name:"appSection",id:"appSection",onChange:a=>s(a.target.value),value:r,placeholder:"App Section",className:"input input-bordered"}),e.jsx("textarea",{name:"ticket",id:"ticket",onChange:a=>t(a.target.value),value:o,rows:3,cols:50,placeholder:"Ticket Description",className:"textarea textarea-bordered min-h-[1rem] resize-none"})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>u(!0),children:"Ticket Log"})]}),e.jsx(N,{closerFunc:u,toggle:f,children:e.jsx(k,{})})]})}export{L as Route};
