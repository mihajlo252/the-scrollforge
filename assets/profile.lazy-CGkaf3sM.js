import{s as x,j as e,B as y,r as u,g as w,a as P,t as g,c as k,b as I,d as $,u as F,C as B,m as E}from"./index-BG-pAVq7.js";import{D as R}from"./DeleteButton-DVYoC1xA.js";import{P as C,A as N}from"./Popup-DDpIUKiU.js";const q=async l=>{try{const{error:t}=await x.from("characters").delete().eq("id",l);if(t)throw t.message}catch(t){throw t}},A=({deleteID:l,setDeleteID:t,setIsDeleted:s})=>{const r=async c=>{await q(c),s(!0),t("")};return e.jsxs(y,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${l!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>r(l),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>t(""),children:"Cancel"})]})]})},U=async(l,t)=>{try{const{error:s}=await x.from("characters").insert({name:l.name,characterProfile:l,profileID:t});if(s)throw s.message}catch(s){throw s}},z=({openCreateCharacter:l,setOpenCreateCharacter:t,setIsSave:s})=>{if(!l)return;const[r,c]=u.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),i=async a=>{a.preventDefault();const{user:p}=JSON.parse(w());await U(r,p.id),s(!0),t(!1)};return e.jsx(C,{closerFunc:t,children:e.jsxs(y,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:a=>i(a),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:a=>c({...r,name:a.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:a=>c({...r,level:parseInt(a.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:a=>c({...r,class:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:a=>c({...r,subclass:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:a=>c({...r,race:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:a=>c({...r,subrace:a.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},L=async({bucket:l,name:t})=>{try{if(t=="")return{publicUrl:null};const{data:s}=x.storage.from(l).getPublicUrl(t);return s}catch(s){throw s}},G=({bucket:l,characterName:t})=>{const[s,r]=u.useState(""),[c,i]=u.useState(!1),a=async()=>{const{publicUrl:o}=await L({bucket:l,name:`${t}.png`});o!==null&&r(`${o}?t=${Date.now()}`)},p=async o=>{var m;o.preventDefault();const d=(m=o.target.elements[0].files)==null?void 0:m[0];if(!d)return;if((d==null?void 0:d.size)>1048576){g({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 1MB."});return}const{error:f}=await x.storage.from("characters").upload(`${t}.png`,d,{cacheControl:"0",upsert:!0});f||(i(!1),r(b=>`${b}?t=${Date.now()}`),g({style:"bg-primary text-base-100",message:"Image changed. It might take some time to update."}))},h=async()=>{await x.storage.from("characters").remove([`${t}.png`]),r(o=>`${o}?t=${Date.now()}`),i(!1),g({style:"bg-primary text-base-100",message:"Image removed. It might take some time to update."})};return u.useEffect(()=>{a()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>i(!0),children:[e.jsx("img",{src:s,alt:(t.charAt(0)+t.charAt(1)).toUpperCase(),className:"object-cover object-top text-center text-4xl text-primary"}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(N,{children:c&&e.jsx(C,{closerFunc:i,children:e.jsxs("form",{onSubmit:p,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:o=>{o.preventDefault(),i(!1)},children:"Cancel"})]}),e.jsx(P,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:h})]})})})]})},O=k("/profile")({component:J});function J(){const{characters:l,setCharacters:t}=I(),{setCharacter:s}=$(),[r,c]=u.useState(!1),[i,a]=u.useState(""),[p,h]=u.useState(!1),[o,d]=u.useState(!1),{user:f}=JSON.parse(w()),m=F(),b=()=>{t(f.id)},S=n=>{s(n),m({to:"/character"})},D=n=>{a(n.id)};return u.useEffect(()=>{b()},[]),u.useEffect(()=>{(r||o)&&(b(),console.log("count")),c(!1),d(!1)},[r,o]),e.jsx(B,{getResetKey:()=>"reset",onCatch:()=>m({to:"/"}),children:e.jsx(E.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(y,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(N,{children:p&&e.jsx(z,{openCreateCharacter:p,setOpenCreateCharacter:h,setIsSave:d})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:f.user_metadata.username}),e.jsx("button",{onClick:()=>h(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:l.map(n=>{var j,v;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(G,{bucket:"characters",characterName:n.characterProfile.name.toLowerCase()}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>S(n),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[n.characterProfile.name,", ",n.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[n.characterProfile.race," ",(j=n.characterProfile)==null?void 0:j.subrace,","," ",n.characterProfile.class," ",(v=n.characterProfile)==null?void 0:v.subclass]})]})}),e.jsx(R,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>D(n)})]},n.id)})}),i&&e.jsx(A,{deleteID:i,setDeleteID:a,setIsDeleted:c})]})})})}export{O as Route};
