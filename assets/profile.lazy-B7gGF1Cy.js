import{s as g,j as e,B as v,r as i,g as N,a as k,t as j,c as P,b as I,d as $,u as A,C as E,m as q}from"./index-BcaVCaEh.js";import{D as B}from"./DeleteButton-ZAGnjwnN.js";import{P as S,A as D}from"./Popup-D-TpkLq8.js";const F=async l=>{try{const{error:t}=await g.from("characters").delete().eq("id",l);if(t)throw t.message}catch(t){throw t}},R=({deleteID:l,setDeleteID:t,setIsDeleted:c})=>{const a=async n=>{await F(n),c(!0),t("")};return e.jsxs(v,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${l!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(l),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>t(""),children:"Cancel"})]})]})},U=async(l,t)=>{try{const{error:c}=await g.from("characters").insert({name:l.name,characterProfile:l,profileID:t});if(c)throw c.message}catch(c){throw c}},z=({openCreateCharacter:l,setOpenCreateCharacter:t,setIsSave:c})=>{if(!l)return;const[a,n]=i.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),u=async s=>{s.preventDefault();const{user:p}=JSON.parse(N());await U(a,p.id),c(!0),t(!1)};return e.jsx(S,{closerFunc:t,children:e.jsxs(v,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:s=>u(s),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:s=>n({...a,name:s.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:s=>n({...a,level:parseInt(s.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:s=>n({...a,class:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:s=>n({...a,subclass:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:s=>n({...a,race:s.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:s=>n({...a,subrace:s.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},L=({bucket:l,characterName:t})=>{const[c,a]=i.useState(""),[n,u]=i.useState(!1),[s,p]=i.useState(!1),x=async()=>{const o=`https://iyfoqgbhaxcedpmuvfkr.supabase.co/storage/v1/object/public/${l}/${t}.png`;a(`${o}?t=${Date.now()}`)},m=async o=>{var b;o.preventDefault();const d=(b=o.target.elements[0].files)==null?void 0:b[0];if(!d)return;if((d==null?void 0:d.size)>307200){j({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 300KB."});return}const{error:f}=await g.storage.from("characters").upload(`${t}.png`,d,{cacheControl:"0",upsert:!0});f||(u(!1),p(!1),a(y=>`${y}?t=${Date.now()}`),j({style:"bg-primary text-base-100",message:"Image changed. It might take some time to update."}))},h=async()=>{await g.storage.from("characters").remove([`${t}.png`]),a(o=>`${o}?t=${Date.now()}`),u(!1),p(!0),j({style:"bg-primary text-base-100",message:"Image removed. It might take some time to update."})};return i.useEffect(()=>{x()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>u(!0),children:[e.jsx("img",{src:c,onError:()=>p(!0),alt:(t.charAt(0)+t.charAt(1)).toUpperCase(),className:`object-cover object-top text-center text-4xl text-primary ${s&&"opacity-0"}`}),e.jsx("div",{className:`absolute inset-0 place-content-center text-center text-4xl text-primary opacity-0 ${s&&"opacity-100"}`,children:e.jsx("p",{children:(t.charAt(0)+t.charAt(1)).toUpperCase()})}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(D,{children:n&&e.jsx(S,{closerFunc:u,children:e.jsxs("form",{onSubmit:m,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:o=>{o.preventDefault(),u(!1)},children:"Cancel"})]}),e.jsx(k,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:h})]})})})]})},O=P("/profile")({component:G});function G(){const{characters:l,setCharacters:t}=I(),{setCharacter:c}=$(),[a,n]=i.useState(!1),[u,s]=i.useState(""),[p,x]=i.useState(!1),[m,h]=i.useState(!1),{user:o}=JSON.parse(N()),d=A(),f=()=>{t(o.id)},b=r=>{c(r),d({to:"/character"})},y=r=>{s(r.id)};return i.useEffect(()=>{f()},[]),i.useEffect(()=>{(a||m)&&(f(),console.log("count")),n(!1),h(!1)},[a,m]),e.jsx(E,{getResetKey:()=>"reset",onCatch:()=>d({to:"/"}),children:e.jsx(q.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(v,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(D,{children:p&&e.jsx(z,{openCreateCharacter:p,setOpenCreateCharacter:x,setIsSave:h})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:o.user_metadata.username}),e.jsx("button",{onClick:()=>x(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:l.map(r=>{var C,w;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(L,{bucket:"characters",characterName:r.characterProfile.name.toLowerCase()}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>b(r),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[r.characterProfile.name,", ",r.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[r.characterProfile.race," ",(C=r.characterProfile)==null?void 0:C.subrace,","," ",r.characterProfile.class," ",(w=r.characterProfile)==null?void 0:w.subclass]})]})}),e.jsx(B,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>y(r)})]},r.id)})}),u&&e.jsx(R,{deleteID:u,setDeleteID:s,setIsDeleted:n})]})})})}export{O as Route};
