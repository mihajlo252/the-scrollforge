import{c as d,r as a,s as l,j as s,m as b,B as m,t as y,g as f}from"./index-C2frkvsY.js";const N=d("/chat")({component:j});function j(){const[x,o]=a.useState(""),[n,c]=a.useState([{}]),p=async e=>{if(e.preventDefault(),e.target[0].value===""){y({style:"bg-error text-base-100",message:"Please enter a message"});return}const t=JSON.parse(f()).user.id,r=JSON.parse(f()).user.user_metadata.username,{error:u}=await l.from("messages").insert({content:e.target[0].value,user_id:t,username:r});o(""),u&&console.error("Error sending message:",u)},g=e=>{e.preventDefault(),o(e.target.value)},h=async()=>{let{data:e}=await l.from("messages").select("*");e&&c(e.map(t=>t))};a.useEffect(()=>{h();const e=l.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},t=>{c(r=>[...r,t.new])}).subscribe();return()=>{l.removeChannel(e)}},[]);const i=a.useRef(null);return a.useEffect(()=>{var e;n.length&&((e=i.current)==null||e.scrollIntoView({behavior:"smooth",block:"end"}))},[n.length]),s.jsx(b.main,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"m-0 h-full w-full p-0",children:s.jsxs(m,{styles:"w-full h-full flex flex-col px-10 py-5 gap-10 justify-between",children:[s.jsxs(m,{styles:"w-full max-h-[70vh] flex flex-col flex-grow px-5 py-5 gap-5 overflow-y-scroll no-scrollbar",children:[s.jsx("ul",{className:"flex flex-col justify-start gap-2",children:n.map((e,t)=>s.jsxs("li",{className:"flex flex-col text-left",children:[s.jsx("label",{className:"text-xl font-bold capitalize text-primary",children:e.username}),s.jsxs("div",{className:"flex justify-between",children:[e.content,s.jsx("span",{className:"text-accent",children:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})]})]},t))}),s.jsx("div",{ref:i,className:"px-5 text-left"})]}),s.jsxs("form",{onSubmit:p,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:x,onChange:g,placeholder:"Type a message...",className:"input input-bordered flex-grow"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Send"})]})]})})}export{N as Route};
