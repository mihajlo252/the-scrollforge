import{s as f,r as o,j as e,B as m,g as v,c as w,b as S,a as P,u as D,C as k,m as I}from"./index-CPu0pdri.js";import{D as B}from"./DeleteButton-CxjWvWM5.js";import{P as F,A as q}from"./Popup-jzsM-SXt.js";const E=async({bucket:r,folder:t,name:l})=>{try{let s=`${t}/${l}`;t==""&&(s=l);const{data:n}=f.storage.from(r).getPublicUrl(s);return n}catch(s){throw s}},R=({bucket:r,folder:t,name:l,alt:s,fallbackSrc:n})=>{const[i,a]=o.useState(n),[u,p]=o.useState(!1),h=async()=>{const{publicUrl:d}=await E({bucket:r,folder:t,name:l});if(d.endsWith("null")){p(!0);return}a(d)};return o.useEffect(()=>{h()},[]),e.jsx("img",{src:i,alt:s,className:`h-20 w-20 rounded-badge border-2 border-slate-900 ${u?"opacity-50 p-2":""}`})},A=async r=>{try{const{error:t}=await f.from("characters").delete().eq("id",r);if(t)throw t.message}catch(t){throw t}},$=({deleteID:r,setDeleteID:t,setIsDeleted:l})=>{const s=async n=>{await A(n),l(!0),t("")};return e.jsxs(m,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${r!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>s(r),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>t(""),children:"Cancel"})]})]})},L="/dash-and-play/assets/avatarplaceholder.png",U=async(r,t)=>{try{const{error:l}=await f.from("characters").insert({name:r.name,characterProfile:r,profileID:t});if(l)throw l.message}catch(l){throw l}},z=({openCreateCharacter:r,setOpenCreateCharacter:t,setIsSave:l})=>{if(!r)return;const[s,n]=o.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),i=async a=>{a.preventDefault();const{user:u}=JSON.parse(v());await U(s,u.id),l(!0),t(!1)};return e.jsx(F,{closerFunc:t,children:e.jsxs(m,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:a=>i(a),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:a=>n({...s,name:a.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:a=>n({...s,level:parseInt(a.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:a=>n({...s,class:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:a=>n({...s,subclass:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:a=>n({...s,race:a.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:a=>n({...s,subrace:a.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},K=w("/profile")({component:G});function G(){const{characters:r,setCharacters:t}=S(),{setCharacter:l}=P(),[s,n]=o.useState(!1),[i,a]=o.useState(""),[u,p]=o.useState(!1),[h,d]=o.useState(!1),{user:x}=JSON.parse(v()),b=D(),g=()=>{t(x.id)},C=c=>{l(c),b({to:"/character"})},N=c=>{a(c.id)};return o.useEffect(()=>{g()},[]),o.useEffect(()=>{(s||h)&&(g(),console.log("count")),n(!1),d(!1)},[s,h]),e.jsx(k,{getResetKey:()=>"reset",onCatch:()=>b({to:"/"}),children:e.jsx(I.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(m,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(q,{children:u&&e.jsx(z,{openCreateCharacter:u,setOpenCreateCharacter:p,setIsSave:d})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:x.user_metadata.username}),e.jsx("button",{onClick:()=>p(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:r.map(c=>{var y,j;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsxs("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>C(c),children:[e.jsx(R,{bucket:"characters",folder:"",name:c.avatar,alt:c.characterProfile.name,fallbackSrc:L}),e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[c.characterProfile.name,", ",c.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[c.characterProfile.race," ",(y=c.characterProfile)==null?void 0:y.subrace,","," ",c.characterProfile.class," ",(j=c.characterProfile)==null?void 0:j.subclass]})]})]}),e.jsx(B,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>N(c)})]},c.id)})}),i&&e.jsx($,{deleteID:i,setDeleteID:a,setIsDeleted:n})]})})})}export{K as Route};
