import{c as p,r as l,s as n,j as s,m as g,B as u,t as d,g as h}from"./index-3MBFtTjf.js";const j=p("/chat")({component:b});function b(){const[m,o]=l.useState(""),[r,c]=l.useState([{content:"",created_at:"",id:"",user_id:"",username:""}]),f=async e=>{if(e.preventDefault(),e.target[0].value===""){d({style:"bg-error text-base-100",message:"Please enter a message"});return}const t=JSON.parse(h()).user.id,{error:a}=await n.from("messages").insert({content:e.target[0].value,user_id:t,username:"beca"});o(""),a&&console.error("Error sending message:",a)},x=e=>{e.preventDefault(),o(e.target.value)};l.useEffect(()=>{const e=async()=>{let{data:t}=await n.from("messages").select("*");t&&c(t.map(a=>a))};return()=>{e()}},[]),l.useEffect(()=>{const e=n.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},t=>{c(a=>[...a,t.new])}).subscribe();return()=>{n.removeChannel(e)}},[]);const i=l.useRef(null);return l.useEffect(()=>{var e;r.length&&((e=i.current)==null||e.scrollIntoView({behavior:"smooth",block:"end"}))},[r.length]),s.jsx(g.main,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"m-0 h-full w-full p-0",children:s.jsxs(u,{styles:"w-full h-full flex flex-col px-10 py-5 gap-10 justify-between",children:[s.jsxs(u,{styles:"w-full max-h-[70vh] flex flex-col flex-grow px-5 py-5 gap-5 overflow-y-scroll no-scrollbar",children:[s.jsx("ul",{className:"flex flex-col justify-start gap-2",children:r.map((e,t)=>s.jsxs("li",{className:"flex flex-col text-left",children:[s.jsx("label",{className:"text-xl font-bold capitalize text-primary",children:e.username}),s.jsxs("div",{className:"flex justify-between",children:[e.content,s.jsx("span",{className:"text-accent",children:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})]})]},t))}),s.jsx("div",{ref:i,className:"border-2 px-5 text-left"})]}),s.jsxs("form",{onSubmit:f,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:m,onChange:x,placeholder:"Type a message...",className:"input input-bordered flex-grow"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Send"})]})]})})}export{j as Route};
