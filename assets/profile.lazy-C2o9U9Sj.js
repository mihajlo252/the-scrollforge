import{s as g,j as e,B as C,r as o,g as D,a as I,t as j,c as A,b as $,d as E,u as F,C as q,m as B}from"./index-BEnFLfvF.js";import{P as w,A as v}from"./Popup-CLLS-mV6.js";import{D as R}from"./DeleteButton-DRlqWxH4.js";const z=async c=>{try{const{error:s}=await g.from("characters").delete().eq("id",c);if(s)throw s.message}catch(s){throw s}},L=({deleteID:c,setDeleteID:s,setIsDeleted:l,setIsDelete:a})=>{const n=async t=>{await z(t),l(!0),a(!1),s("")},i=t=>{t.preventDefault(),a(!1),s("")};return e.jsx(w,{closerFunc:a,children:e.jsxs(C,{styles:"fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5",children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>n(c),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:i,children:"Cancel"})]})]})})},U=async(c,s)=>{try{const{error:l}=await g.from("characters").insert({name:c.name,characterProfile:c,profileID:s});if(l)throw l.message}catch(l){throw l}},G=({openCreateCharacter:c,setOpenCreateCharacter:s,setIsSave:l})=>{if(!c)return;const[a,n]=o.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),i=async t=>{t.preventDefault();const{user:p}=JSON.parse(D());await U(a,p.id),l(!0),s(!1)};return e.jsx(w,{closerFunc:s,children:e.jsxs(C,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:t=>i(t),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:t=>n({...a,name:t.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:t=>n({...a,level:parseInt(t.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:t=>n({...a,class:t.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:t=>n({...a,subclass:t.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:t=>n({...a,race:t.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:t=>n({...a,subrace:t.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>s(!1),children:"Cancel"})]})]})]})})},J=({bucket:c,characterName:s})=>{const[l,a]=o.useState(`https://iyfoqgbhaxcedpmuvfkr.supabase.co/storage/v1/object/public/${c}/${s}.png`),[n,i]=o.useState(!1),[t,p]=o.useState(!0),h=async()=>{fetch(l,{method:"HEAD"}).then(async u=>{u.ok&&p(!1)})},f=async u=>{var x;u.preventDefault();const d=(x=u.target.elements[0].files)==null?void 0:x[0];if(!d)return;if((d==null?void 0:d.size)>307200){j({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 300KB."});return}const{error:b}=await g.storage.from("characters").upload(`${s}.png`,d,{cacheControl:"0",upsert:!0});b||(i(!1),p(!1),a(y=>`${y}?t=${Date.now()}`),j({style:"bg-primary text-base-100",message:"Image changed!"}))},m=async()=>{await g.storage.from("characters").remove([`${s}.png`]),a(u=>`${u}?t=${Date.now()}`),i(!1),p(!0),j({style:"bg-primary text-base-100",message:"Image removed!"})};return o.useEffect(()=>{h()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>i(!0),children:[e.jsx("img",{src:l,onError:()=>p(!0),alt:(s.charAt(0)+s.charAt(1)).toUpperCase(),className:`object-cover object-top text-center text-4xl text-primary transition-opacity ${t&&"opacity-0"}`}),e.jsx("div",{className:`absolute inset-0 place-content-center text-center text-4xl text-primary transition-opacity opacity-0 ${t&&"opacity-100"}`,children:e.jsx("p",{children:(s.charAt(0)+s.charAt(1)).toUpperCase()})}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(v,{children:n&&e.jsx(w,{closerFunc:i,children:e.jsxs("form",{onSubmit:f,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:u=>{u.preventDefault(),i(!1)},children:"Cancel"})]}),e.jsx(I,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:m})]})})})]})},T=A("/profile")({component:K});function K(){const{characters:c,setCharacters:s}=$(),{setCharacter:l}=E(),[a,n]=o.useState(!1),[i,t]=o.useState(""),[p,h]=o.useState(!1),[f,m]=o.useState(!1),[u,d]=o.useState(!1),{user:b}=JSON.parse(D()),x=F(),y=()=>{s(b.id)},P=r=>{l(r),x({to:"/character"})},k=r=>{t(r.id),d(!0)};return o.useEffect(()=>{y()},[]),o.useEffect(()=>{(a||f)&&y(),n(!1),m(!1)},[a,f]),e.jsx(q,{getResetKey:()=>"reset",onCatch:()=>x({to:"/"}),children:e.jsx(B.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(C,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(v,{children:p&&e.jsx(G,{openCreateCharacter:p,setOpenCreateCharacter:h,setIsSave:m})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:b.user_metadata.username}),e.jsx("button",{onClick:()=>h(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:c.map(r=>{var N,S;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(J,{bucket:"characters",characterName:r.characterProfile.name.toLowerCase()}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>P(r),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[r.characterProfile.name,", ",r.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[r.characterProfile.race," ",(N=r.characterProfile)==null?void 0:N.subrace,","," ",r.characterProfile.class," ",(S=r.characterProfile)==null?void 0:S.subclass]})]})}),e.jsx(R,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>k(r)})]},r.id)})}),e.jsx(v,{children:u&&e.jsx(L,{deleteID:i,setDeleteID:t,setIsDeleted:n,setIsDelete:d})})]})})})}export{T as Route};
