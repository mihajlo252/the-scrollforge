import{s as w,j as e,B as D,r as i,g as R,a as F,t as S,c as B,b as q,d as $,u as z,C as L,m as T}from"./index-DXL1NQF7.js";import{D as V}from"./DeleteButton-Br6owQT4.js";import{P as A,A as E}from"./Popup-BN7Uce8p.js";import{s as P}from"./sendData-B3Qx1WFb.js";const G=async t=>{try{const{error:a}=await w.from("characters").delete().eq("id",t);if(a)throw a.message}catch(a){throw a}},J=({deleteID:t,setDeleteID:a,setIsDeleted:c})=>{const s=async r=>{await G(r),c(!0),a("")};return e.jsxs(D,{styles:`fixed h-min px-10 py-16 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-5 ${t!=""?"flex":"hidden"}`,children:[e.jsx("p",{children:"Are you sure you want to continue?"}),e.jsxs("div",{className:"flex items-center justify-center gap-20",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>s(t),children:"Yes"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>a(""),children:"Cancel"})]})]})},Y=async(t,a)=>{try{const{error:c}=await w.from("characters").insert({name:t.name,characterProfile:t,profileID:a});if(c)throw c.message}catch(c){throw c}},_=({openCreateCharacter:t,setOpenCreateCharacter:a,setIsSave:c})=>{if(!t)return;const[s,r]=i.useState({class:"",level:0,name:"",race:"",subclass:"",subrace:""}),m=async l=>{l.preventDefault();const{user:x}=JSON.parse(R());await Y(s,x.id),c(!0),a(!1)};return e.jsx(A,{closerFunc:a,children:e.jsxs(D,{styles:"relative h-min flex flex-col gap-5 justify-center items-center text-center px-20 py-10",children:[e.jsx("h2",{className:"text-4xl font-bold",children:"Create Your Character"}),e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:l=>m(l),children:[e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Name",required:!0,onChange:l=>r({...s,name:l.target.value})}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"Level",required:!0,onChange:l=>r({...s,level:parseInt(l.target.value)})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Class",required:!0,onChange:l=>r({...s,class:l.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subclass",onChange:l=>r({...s,subclass:l.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Race",required:!0,onChange:l=>r({...s,race:l.target.value})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Subrace",onChange:l=>r({...s,subrace:l.target.value})}),e.jsxs("div",{className:"mt-10 flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",children:"Create"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-1",onClick:()=>a(!1),children:"Cancel"})]})]})]})})},H=async({bucket:t,folder:a,name:c})=>{try{if(c=="")return{publicUrl:null};let s=`${a}/${c}`;a==""&&(s=c);const{data:r}=w.storage.from(t).getPublicUrl(s);return r}catch(s){throw s}},o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function K(t,a=0){return(o[t[a+0]]+o[t[a+1]]+o[t[a+2]]+o[t[a+3]]+"-"+o[t[a+4]]+o[t[a+5]]+"-"+o[t[a+6]]+o[t[a+7]]+"-"+o[t[a+8]]+o[t[a+9]]+"-"+o[t[a+10]]+o[t[a+11]]+o[t[a+12]]+o[t[a+13]]+o[t[a+14]]+o[t[a+15]]).toLowerCase()}let I;const M=new Uint8Array(16);function O(){if(!I){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");I=crypto.getRandomValues.bind(crypto)}return I(M)}const W=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),k={randomUUID:W};function Q(t,a,c){var r;if(k.randomUUID&&!t)return k.randomUUID();t=t||{};const s=t.random??((r=t.rng)==null?void 0:r.call(t))??O();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,K(s)}const X=({bucket:t,id:a,folder:c,name:s,characterName:r,setChangeImage:m})=>{const[l,x]=i.useState(""),[y,d]=i.useState(!1),[j,v]=i.useState(!1),[C,f]=i.useTransition(),h=async()=>{const{publicUrl:u}=await H({bucket:t,folder:c,name:s});if(u!==null){if(!u.endsWith(".png")){v(!0);return}x(u)}},b=async u=>{var U;u.preventDefault();const n=Q(),p=(U=u.target.elements[0].files)==null?void 0:U[0];if(!p)return;if((p==null?void 0:p.size)>1048576){S({style:"bg-error text-base-100",message:"File is too large! Please keep file size below 1MB."});return}const{error:g}=await w.storage.from("characters").upload(`${c}/${n}.png`,p,{cacheControl:"3",upsert:!0});if(g){console.error(g);return}await P("characters",a,{avatar:`${n}.png`}),h(),d(!1),S({style:"bg-primary text-base-100",message:"Image changed. It might take some time to update."}),f(()=>{m(!0)})},N=async()=>{await P("characters",a,{avatar:null}),h(),d(!1),S({style:"bg-primary text-base-100",message:"Image removed. It might take some time to update."}),f(()=>{m(!0)})};return i.useEffect(()=>{h(),console.log(l)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative aspect-square w-24 overflow-hidden rounded-badge border-2 border-slate-900",onClick:()=>d(!0),children:[j?e.jsx("p",{className:"text-center text-4xl text-primary",children:(r.charAt(0)+r.charAt(1)).toUpperCase()}):e.jsx("img",{src:l,alt:(r.charAt(0)+r.charAt(1)).toUpperCase(),className:"object-cover object-top"}),e.jsx("div",{className:"absolute inset-0 place-content-center bg-black/50 text-lg opacity-0 transition-opacity hover:opacity-100",children:e.jsx("p",{children:"Edit"})})]}),e.jsx(E,{children:y&&e.jsx(A,{closerFunc:d,children:e.jsxs("form",{onSubmit:b,className:"flex flex-col gap-5",children:[e.jsx("h2",{className:"mb-10 text-3xl text-accent",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"file-input file-input-bordered file-input-accent w-full max-w-xs flex-grow place-self-center"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-accent flex-grow",children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-secondary flex-grow",onClick:u=>{u.preventDefault(),d(!1)},children:"Cancel"})]}),e.jsx(F,{text:"Remove Image",style:"border-secondary py-4 text-secondary hover:bg-secondary hover:text-white",event:N})]})})})]})},re=B("/profile")({component:Z});function Z(){const{characters:t,setCharacters:a}=q(),{setCharacter:c}=$(),[s,r]=i.useState(!1),[m,l]=i.useState(""),[x,y]=i.useState(!1),[d,j]=i.useState(!1),[v,C]=i.useState(!1),{user:f}=JSON.parse(R()),h=z(),b=()=>{a(f.id)},N=n=>{c(n),h({to:"/character"})},u=n=>{l(n.id)};return i.useEffect(()=>{b()},[]),i.useEffect(()=>{v&&(b(),C(!1))},[v]),i.useEffect(()=>{(s||d)&&(b(),console.log("count")),r(!1),j(!1)},[s,d]),e.jsx(L,{getResetKey:()=>"reset",onCatch:()=>h({to:"/"}),children:e.jsx(T.main,{className:"flex h-full w-full gap-5",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(D,{styles:"w-full flex flex-col items-start gap-10 p-5 overflow-y-scroll relative",children:[e.jsx(E,{children:x&&e.jsx(_,{openCreateCharacter:x,setOpenCreateCharacter:y,setIsSave:j})}),e.jsxs("section",{className:"flex w-full justify-between",children:[e.jsx("h1",{className:"text-5xl text-primary",children:f.user_metadata.username}),e.jsx("button",{onClick:()=>y(!0),className:"btn btn-ghost border-2 border-primary text-primary hover:border-primary hover:bg-primary hover:text-base-100",children:"Create Character"})]}),e.jsx("ul",{className:"flex w-full flex-col gap-2 text-xl",children:t.map(n=>{var p,g;return e.jsxs("div",{className:"relative flex w-full items-center gap-5 rounded-badge border-2 border-slate-900 p-2 transition-colors hover:cursor-pointer hover:bg-slate-800",children:[e.jsx(X,{bucket:"characters",id:n.id,characterName:n.characterProfile.name,folder:"",name:n.avatar,setChangeImage:C}),e.jsx("li",{className:"flex h-full w-full items-center gap-5",onClick:()=>N(n),children:e.jsxs("div",{className:"text-start",children:[e.jsxs("p",{children:[n.characterProfile.name,", ",n.characterProfile.level]}),e.jsx("div",{className:"h-[.5px] w-full bg-neutral"}),e.jsxs("p",{children:[n.characterProfile.race," ",(p=n.characterProfile)==null?void 0:p.subrace,","," ",n.characterProfile.class," ",(g=n.characterProfile)==null?void 0:g.subclass]})]})}),e.jsx(V,{size:60,styles:" transition-colors rounded-badge  fill-base-300 hover:fill-slate-900 hover:stroke-secondary stroke-primary",event:()=>u(n)})]},n.id)})}),m&&e.jsx(J,{deleteID:m,setDeleteID:l,setIsDeleted:r})]})})})}export{re as Route};
